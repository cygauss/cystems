##安装
#net iwctl station wlan0 connect ssid
timedatectl
#cfdisk /dev/nvme0n1
#mkfs.fat -F 32 /dev/nvme0n1p1 && mkfs.ext4 /dev/nvme0n1p2
#mount /dev/nvme0n1p2 /mnt 
mkdir /mnt/boot
#mount /dev/nvme0n1p1 /mnt
echo -e "Server = http://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch\nServer = http://mirrors.pku.edu.cn/archlinux/$repo/os/$arch" > /etc/pacman.d/mirrorlist
pacstrap -K /mnt base linux linux-firmware networkmanager efibootmgr intel-ucode
genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt
##chroot会终止脚本
ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 
hwclock --systohc
##虽然只使用LANG=sg，但是一些软件不自带语言环境，需要locale提供，故选用中文
echo -e "en_SG.UTF-8 UTF-8\nzh_CN.UTF-8 UTF-8" >> /etc/locale.gen
locale-gen
echo "LANG=en_SG.UTF-8" >> /etc/locale.conf
echo "Archy" >> /etc/hostname
passwd
#efibootmgr -c -d /dev/nvme0n1p1 -l /vmlinuz-linux -L "Arch Linux" -u 'initrd=\intel-ucode.img initrd=\initramfs-linux.img root=/dev/nvme0n1p2 quiet rw nowatchdog'
exit
reboot


  
##用户配置
pacman -S sudo nano
useradd -m -G wheel cygauss
passwd cygauss
EDITOR="nano" visudo
##基础下载工具
##修改mirror和repo
echo -e "Server = http://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch\nServer = http://mirrors.pku.edu.cn/archlinuxcn/$arch" >> /etc/pacman.d/archlinuxcn-mirrorlist
nano /etc/pacman.conf
pacman -Sy archlinuxcn-keyring
##yay可以统筹aur和repos
pacman -S yay wget

##显示配置
##nvidia
##为了避免更新 NVIDIA 驱动之后忘了更新 initramfs，你可以使用 Pacman Hooks：
##安装后把kms 从 /etc/mkinitcpio.conf 里的HOOKS 数组中移除，并 重新生成 initramfs。
##To enable DRM (Direct Rendering Manager) kernel mode setting, set modeset=1 and fbdev=1 kernel module parameters for the nvidia_drm module.
##如果任何受影响的模块是从 initramfs 加载的，那么您需要将适当的 .conf 文件添加到 mkinitcpio.conf 中的 FILES
echo "options nvidia_drm modeset=1 fbdev=1" > /etc/modprobe.d/nvidia_drm.conf
nano /etc/mkinitcpio.conf
cd /etc/pacman.d/hooks/
wget raw.githubusercontent.com/cygauss/cystems/main/archy/nvidia.hook
cd -
##prime-run前缀脚本以用独显运行
pacman -S nvidia nvidia-prime
reboot

##wayland
##GUIlib
pacman -S gtk4 qt6-wayland qt5ct
echo -e "QT_QPA_PLATFORM=wayland\nQT_QPA_PLATFORMTHEME=qt5ct" >> /etc/environment
##Hyprland kitty
pacman -S hyprland-nvidia-hidpi-git kitty
##字体和输入法
pacman -S noto-fonts-cjk fcitx5-im fcitx5-rime 
##修改环境变量和随hyprland启动,ibus项是因为kitty
echo -e "GTK_IM_MODULE=fcitx\nQT_IM_MODULE=fcitx\nXMODIFIERS=@im=fcitx\nSDL_IM_MODULE=fcitx\nGLFW_IM_MODULE=ibus" >> /etc/environment
fcitx5-configtool
##fcitx5 -d为其运行deamon

##声音
pacman -S pipewire wireplumber helvum

##v2raya
pacman -S v2raya-git
systemctl enable v2raya.service
